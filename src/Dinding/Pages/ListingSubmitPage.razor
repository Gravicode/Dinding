@page "/listing_submit"
@inject IJSRuntime IJS

@inject NavigationManager NavMgr
@inject IToastService toastService
@using Dinding.Tools
@inject ListingService ListingSvc
@inject UserProfileService service
@inject CategoryService CategorySvc
@inject SubCategoryService SubCategorySvc

<BreadcrumbPage LinkName="Submit Listing" LinkUrl="/listing_submit"></BreadcrumbPage>

<div id="dashboard_inner_block">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <div class="col-md-12 all-categorie-list-title bt_heading_3">
                    <h1>Submit <span>Listing</span></h1>
                    <div class="blind line_1"></div>
                    <div class="flipInX-1 blind icon"><span class="icon"><i class="fa fa-stop"></i>&nbsp;&nbsp;<i class="fa fa-stop"></i></span></div>
                    <div class="blind line_2"></div>
                </div>
                <div class="row">
                    <InnerSideBarPage></InnerSideBarPage>
                    <div class="col-md-9 col-sm-8 col-xs-12">
                        <div class="submit_listing_box">
                            <h3>Description</h3>
                            <form class="form-alt">
                                <div class="form-group">
                                    <label>Title :-</label>
                                    <input @bind="DataListing.Title" placeholder="Title" class="form-control" type="text">
                                </div>
                                <div class="form-group">
                                    <label>Listing Description :-</label>
                                    <textarea placeholder="Listing description..." class="form-control" rows="5"></textarea>
                                </div>
                            </form>
                        </div>
                        <div class="submit_listing_box">
                            <h3>Attributes</h3>
                            <form class="form-alt">
                                <div class="row">
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Property Type :-</label>
                                        <select class="form-control selectcategory" name="parent-cateogry">
                                            <option value="0">Select Category</option>
                                            <option value="1">Property Type</option>
                                            <option value="2">Automotive</option>
                                            <option value="3">Food</option>
                                            <option value="4">Shopping</option>
                                            <option value="5">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Contract :-</label>
                                        <select class="form-control selectcategory" name="parent-cateogry">
                                            <option value="0">Select Contract</option>
                                            <option value="1">Lorem Ipsum</option>
                                            <option value="2">Lorem Ipsum</option>
                                            <option value="3">Lorem Ipsum</option>
                                            <option value="4">Lorem Ipsum</option>
                                            <option value="5">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Location :-</label>
                                        <select class="form-control selectcategory" name="parent-cateogry">
                                            <option value="0">Select Location</option>
                                            <option value="1">Lorem Ipsum</option>
                                            <option value="2">Lorem Ipsum</option>
                                            <option value="3">Lorem Ipsum</option>
                                            <option value="4">Lorem Ipsum</option>
                                            <option value="5">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Price :-</label>
                                        <input placeholder="Price" class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Address :-</label>
                                        <input placeholder="Address" class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>City :-</label>
                                        <input placeholder="City" class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>Phone :-</label>
                                        <input placeholder="Phone" class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-12 col-xs-12">
                                        <label>E-mail :-</label>
                                        <input placeholder="Email" class="form-control" type="text">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="submit_listing_box">
                            <h3>Working Hours</h3>
                            <form class="form-alt">
                                <div class="row">
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Monday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Tuesday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Wednesday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Thursday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Friday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Saturday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-6">
                                        <label>Sunday :-</label>
                                        <input class="form-control" type="text">
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="submit_listing_box">
                            <h3>Map Position</h3>
                            <form class="form-alt">
                                <div class="row">
                                    <div class="form-group col-md-6 col-sm-6- col-xs-12">
                                        <label>Latitude :-</label>
                                        <input placeholder="Latitude" class="form-control" type="text">
                                    </div>
                                    <div class="form-group col-md-6 col-sm-6- col-xs-12">
                                        <label>Lontgitude :-</label>
                                        <input placeholder="Lontgitude" class="form-control" type="text">
                                    </div>
                                </div>
                            </form>
                            <div id="location-map">
                                <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d60470630.45233501!2d73.17308624999998!3d22.32210265!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sin!4v1499682555819" allowfullscreen=""></iframe>
                            </div>
                        </div>
                        <div class="submit_listing_box">
                            <h3>Gallery</h3>
                            <div class="fileupload_block">
                                <input type="file" name="fileupload" id="fileupload">
                                <div class="fileupload_img"> <img src="images/add_image.png" alt="add image" /> </div>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="submit_listing_box">
                            <h3>Amenities</h3>
                            <div class="amenities_block">
                                <ul class="detail-amenities">
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-1" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-1">WiFi</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-2" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-2">Parking</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-3" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-3">Vine</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-4" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-4">Terrace</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-5" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-5">Bar</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-6" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-6">Take Away Coffee</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-7" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-7">Catering</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-8" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-8">Raw Food</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-9" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-9">Delivery</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-10" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-10">No-smoking room</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-11" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-11">WiFi</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-12" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-12">Parking</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-13" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-13">Vine</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-14" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-14">Terrace</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-15" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-15">Bar</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-16" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-16">Take Away Coffee</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-17" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-17">Catering</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-18" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-18">Raw Food</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-19" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-19">Delivery</label>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="checkbox checkbox-success">
                                            <input class="styled" value="5" id="checkbox-20" name="checkbox" type="checkbox">
                                            <label class="control-label" for="checkbox-20">No-smoking room</label>
                                        </div>
                                    </li>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="from-list-lt">
                            <div class="form-group">
                                <button class="btn" type="button" @onclick="SaveListing">Submit Listing</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    bool IsFailed = false;
    UserProfile DataUser = new UserProfile();
    Listing DataListing = new ();
    string ErrorMsg = string.Empty;
    [CascadingParameter]
    private Task<AuthenticationState> authenticationStateTask { get; set; }
    string UserName;


    protected override async Task OnInitializedAsync()
    {

        var user = (await authenticationStateTask).User;

        if (user.Identity.IsAuthenticated)
        {
            UserName = user.Identity.Name;
            DataUser = service.GetItemByUsername(UserName);

        }
       

    }
    async Task SaveListing()
    {
        IsFailed = true;
        bool isPengurus = false;
        ErrorMsg = "";
        UserProfileService svc = new UserProfileService();
      
        if (string.IsNullOrEmpty(DataListing.Email))
        {
            ErrorMsg += "Tolong di isi email. ";

        }
        if (!Dinding.Tools.FormValidation.IsValidEmail(DataListing.Email))
        {
            ErrorMsg += "Format email tidak valid. ";

        }
        if (string.IsNullOrEmpty(DataListing.Alamat))
        {
            ErrorMsg += "Tolong di isi Alamat. ";

        }
        if (string.IsNullOrEmpty(DataListing.Desc))
        {
            ErrorMsg += "Tolong di isi Desc. ";

        }
        if (string.IsNullOrEmpty(DataListing.Facilities))
        {
            ErrorMsg += "Tolong di isi Facilities. ";

        }
       

        DataListing.UserId = DataUser.Id;



        if (ErrorMsg.Length > 0)
        {
            toastService.ShowWarning(ErrorMsg, "Perhatian");
            return;
        }
        
        DataListing.CreatedDate = DateHelper.GetLocalTimeNow();
        if (ListingSvc.InsertData(DataListing))
        {
            toastService.ShowSuccess("Listing berhasil di simpan.", "Info");
            IsFailed = true;
         
        }

    }
}
