@page "/contact"
@inject IJSRuntime IJS
@inject ContactService ContactSvc
@inject IToastService toastService
@inject NavigationManager NavMgr

<BreadcrumbPage LinkName="Contact Us" LinkUrl="/contact"></BreadcrumbPage>

<div id="vfx-product-inner-item">
    <div class="container">
        <div class="row">
            <div class="col-md-12 contact-heading-title text-center bt_heading_3">
                <h1>Contact <span>Us</span></h1>
                <div class="blind line_1"></div>
                <div class="flipInX-1 blind icon"><span class="icon"><i class="fa fa-stop"></i>&nbsp;&nbsp;<i class="fa fa-stop"></i></span></div>
                <div class="blind line_2"></div>
            </div>
            <span class="clt-content">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing.<br><br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.<br><br> It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing.</span>
            <div class="from-list-lt">
                <div class="col-xs-12 col-lg-8 col-sm-12">
                    <div class="form-float form-alt">
                        <div class="row">
                            <div class="form-group col-xs-12 col-sm-6">
                                <span class="from-input-ic"><i class="fa fa-user"></i></span>
                                <input class="form-control" @bind="Data.Firstname" required placeholder="First Name" type="text">
                            </div>
                            <div class="form-group col-xs-12 col-sm-6">
                                <span class="from-input-ic"><i class="fa fa-user"></i></span>
                                <input class="form-control" @bind="Data.Lastname" required placeholder="Last Name" type="text">
                            </div>
                            <div class="form-group col-xs-12 col-sm-6">
                                <span class="from-input-ic"><i class="fa fa-envelope-o"></i></span>
                                <input class="form-control" @bind="Data.Email" required placeholder="Email" type="text">
                            </div>
                            <div class="form-group col-xs-12 col-sm-6">
                                <span class="from-input-ic"><i class="fa fa-phone"></i></span>
                                <input class="form-control" @bind="Data.Phone" required placeholder="Contact Number" type="text">
                            </div>
                            <div class="form-group col-xs-12">
                                <span class="from-input-ic"><i class="fa fa-comments"></i></span>
                                <textarea class="form-control" @bind="Data.Message" required placeholder="Your Message"></textarea>
                            </div>
                            <div class="form-group col-xs-12 col-sm-6">
                                <input class="verifi_code form-control" @bind="TypedCaptcha" required placeholder="Verification Code" type="text">
                            </div>
                            <div class="form-group col-xs-12 col-sm-6">
                                <div class="b-form-vertical__input"> <img id="captcha" src="@CaptchaImage" alt=""> <a href="" @onclick:preventDefault @onclick="GenerateCaptcha"><span class="captchareload"><i class="fa fa-refresh"></i></span></a> </div>
                            </div>
                            <div class="form-group col-xs-12">
                                <button class="btn pull-right" type="button" @onclick="Save">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

             

                <div class="col-xs-12 col-lg-4 col-sm-12">
                    <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12">
                        <div class="media media-iconic">
                            <div class="media-body">
                                <div class="lt-co-icon"> <img src="images/ic-loc.png" alt="ic-loc"> </div>
                                <div class="lt-co-blok-text">
                                    <div class="lt-co-title">Location</div>
                                    <hr class="lt-co-yellow-hr">
                                    <p class="lt-bdr-one">Lorem ipsum dolor sit amet, consectetur isicing elit. Recusandae repudiandae dolores...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12">
                        <div class="media media-iconic">
                            <div class="media-body">
                                <div class="lt-co-icon"> <img src="images/ic-call.png" alt="ic-call"> </div>
                                <div class="lt-co-blok-text">
                                    <div class="lt-co-title">Phone | Email</div>
                                    <hr class="lt-co-green-hr">
                                    <p class="lt-bdr-two">
                                        <b>IND</b> :-&nbsp;+ 000 245 0154<br>
                                        <b>USA</b> :-&nbsp;+ 000 000 2541<br>
                                        <b>E-Mail</b> :-&nbsp;<a href="mailto:dinding@gravicode.com">dinding@gravicode.com</a><br>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-12 col-lg-12 col-sm-12">
                        <div class="media media-iconic">
                            <div class="media-body">
                                <div class="lt-co-icon"> <img src="images/ic-time.png" alt="ic-time"> </div>
                                <div class="lt-co-blok-text">
                                    <div class="lt-co-title">Working Hours</div>
                                    <hr class="lt-bg-blue-hr">
                                    <p class="lt-bdr-three"><b>Mon</b> - <b>Sat</b> :- 9am - 6pm</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@code {

    public string CaptchaImage { get; set; }
    public string Answer { get; set; }
    public string TypedCaptcha { get; set; }

    bool showError = false;
    public Contact Data { get; set; } = new();
    async Task KeyUp(KeyboardEventArgs e)
    {
        if (e.Key == "Enter")
        {
            await Save();
            //Console.WriteLine(this.Value);
        }
    }

    async Task Save()
    {
        var ErrMsg = "";
        if (string.IsNullOrEmpty(Data.Firstname))
        {
            ErrMsg += "Tolong isi Firstname.";
        }
        if (string.IsNullOrEmpty(Data.Lastname))
        {
            ErrMsg += "Tolong isi Lastname.";
        }
        if (string.IsNullOrEmpty(Data.Message))
        {
            ErrMsg += "Tolong isi Message.";
        }
        if (string.IsNullOrEmpty(Data.Email))
        {
            ErrMsg += "Tolong isi Email.";
        }
        if (string.IsNullOrEmpty(Data.Phone))
        {
            ErrMsg += "Tolong isi Phone.";
        }
        if (Answer != TypedCaptcha)
        {
            ErrMsg += "Captcha tidak sesuai.";
        }
        if (ErrMsg.Length > 0)
        {
            toastService.ShowError(ErrMsg, "Perhatian");
        }
        else
        {
            if (ContactSvc.InsertData(Data))
            {
                toastService.ShowSuccess("Contact berhasil di simpan. Terima kasih");
            }
            else
            {
                toastService.ShowError("Gagal menyimpan data. Coba kembali");
            }
        }
       
    }

    void GenerateCaptcha()
    {
        Random oRandom = new Random();
        int iNumber = oRandom.Next(1000, 9999);
        Answer = iNumber.ToString();
        var temp = CaptchaGenerator.GetCaptcha(Answer, 158, 70);
        string base64String = Convert.ToBase64String(temp, 0, temp.Length);
        CaptchaImage = "data:image/png;base64," + base64String;
    }

    [CascadingParameter]
    public MainLayout Layout { get; set; }

    protected override async Task OnInitializedAsync()
    {

       
        if (string.IsNullOrEmpty(CaptchaImage))
            GenerateCaptcha();
    }
}
